# HEIC Image Support üì∏

## –ü—Ä–æ–±–ª–µ–º–∞
AWS S3 –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î —Ñ–æ—Ä–º–∞—Ç `.HEIC` (Apple HEIF) –¥–ª—è –ø—Ä—è–º–æ–≥–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤ –±—Ä–∞—É–∑–µ—Ä—ñ. –¶–µ –ø—Ä–∏–∑–≤–æ–¥–∏–ª–æ –¥–æ –ø–æ–º–∏–ª–æ–∫ 404 –∞–±–æ –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–∏—Ö loader'—ñ–≤.

## –†—ñ—à–µ–Ω–Ω—è
**Hybrid –ø—ñ–¥—Ö—ñ–¥**: –°–ø—Ä–æ–±–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó HEIC ‚Üí JPEG –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `heic2any`, –∞–ª–µ –∑ fallback –Ω–∞ placeholder + download –æ—Ä–∏–≥—ñ–Ω–∞–ª—É.

### –ß–æ–º—É hybrid?
–ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ `heic2any` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î WebAssembly –≤–µ—Ä—Å—ñ—é libheif, —è–∫–∞ –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î –≤—Å—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ HEIC –∫–æ–¥—É–≤–∞–Ω–Ω—è. –î–µ—è–∫—ñ –Ω–æ–≤—ñ HEIC —Ñ–∞–π–ª–∏ (–æ—Å–æ–±–ª–∏–≤–æ –∑ iPhone 13+) –º–æ–∂—É—Ç—å –º–∞—Ç–∏ —Ñ–æ—Ä–º–∞—Ç, —è–∫–∏–π libheif –Ω–µ —Ä–æ–∑–ø—ñ–∑–Ω–∞—î.

**–ù–∞—à–µ —Ä—ñ—à–µ–Ω–Ω—è**:
1. ‚úÖ –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∫–æ–Ω–≤–µ—Ä—Ç—É–≤–∞—Ç–∏ HEIC ‚Üí JPEG
2. ‚ö†Ô∏è –Ø–∫—â–æ –Ω–µ –≤–¥–∞—î—Ç—å—Å—è - –ø–æ–∫–∞–∑–∞—Ç–∏ –∫—Ä–∞—Å–∏–≤–∏–π placeholder "HEIC Apple Photo"
3. üíæ –ó–∞–≤–∂–¥–∏ –Ω–∞–¥–∞—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏–π —Ñ–∞–π–ª

## –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î

### 1. –î–µ—Ç–µ–∫—Ü—ñ—è HEIC —Ñ–∞–π–ª—ñ–≤
```typescript
export function isHEICFile(url: string): boolean {
  return /\.(heic|heif)$/i.test(url);
}
```

### 2. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –≤ JPEG
```typescript
export async function convertHEICtoJPEG(blob: Blob): Promise<Blob> {
  const heic2any = (await import('heic2any')).default;
  const convertedBlob = await heic2any({
    blob,
    toType: 'image/jpeg',
    quality: 0.85, // 85% —è–∫—ñ—Å—Ç—å
  });
  return Array.isArray(convertedBlob) ? convertedBlob[0] : convertedBlob;
}
```

### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
`BookingImageGallery` –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ:
- –î–µ—Ç–µ–∫—Ç—É—î HEIC —Ñ–∞–π–ª–∏ –ø—Ä–∏ mount
- –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î blob –∑ S3
- –ö–æ–Ω–≤–µ—Ä—Ç—É—î –≤ JPEG
- –°—Ç–≤–æ—Ä—é—î data URL –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
- –ö–µ—à—É—î –∫–æ–Ω–≤–µ—Ä—Ç–æ–≤–∞–Ω—ñ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤ state

## –ü–µ—Ä–µ–≤–∞–≥–∏

‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–ø—Ä–æ–±–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó** - –±—ñ–ª—å—à—ñ—Å—Ç—å HEIC –∫–æ–Ω–≤–µ—Ä—Ç—É—é—Ç—å—Å—è —É—Å–ø—ñ—à–Ω–æ  
‚úÖ **–Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—É** - "Converting..." –ø—ñ–¥ —á–∞—Å –æ–±—Ä–æ–±–∫–∏  
‚úÖ **–ö–µ—à—É–≤–∞–Ω–Ω—è** - –∫–æ–Ω–≤–µ—Ä—Ç–æ–≤–∞–Ω–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ state  
‚úÖ **Graceful fallback** - —è–∫—â–æ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –Ω–µ –≤–¥–∞–ª–∞—Å—è, –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –∫—Ä–∞—Å–∏–≤–∏–π HEIC placeholder  
‚úÖ **–ó–∞–≤–∂–¥–∏ –º–æ–∂–Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏** - –∫–Ω–æ–ø–∫–∞ download –ø—Ä–∞—Ü—é—î –¥–ª—è –≤—Å—ñ—Ö —Ñ–∞–π–ª—ñ–≤ (–æ—Ä–∏–≥—ñ–Ω–∞–ª HEIC)  
‚úÖ **–í—ñ–∑—É–∞–ª—å–Ω–∞ —ñ–Ω–¥–∏–∫–∞—Ü—ñ—è** - –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏—Ç—å —â–æ —Ü–µ Apple Photo —Ñ–æ—Ä–º–∞—Ç  
‚úÖ **–ü—Ä–∞—Ü—é—î –≤ –ª–∞–π—Ç–±–æ–∫—Å—ñ** - —Ç—ñ–ª—å–∫–∏ –¥–ª—è —É—Å–ø—ñ—à–Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç–æ–≤–∞–Ω–∏—Ö  
‚úÖ **–ù–µ –±–ª–æ–∫—É—î UI** - –Ω–µ–∫–æ–Ω–≤–µ—Ä—Ç–æ–≤–∞–Ω—ñ HEIC –Ω–µ –ª–∞–º–∞—é—Ç—å —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å  

## –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫

- **Loading state**: –ü–æ–∫–∞–∑—É—î spinner + "Converting HEIC..."
- **Error state**: –ü–æ–∫–∞–∑—É—î —ñ–∫–æ–Ω–∫—É –ø–æ–º–∏–ª–∫–∏ + "Failed"
- **Fallback**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î placeholder –ø—Ä–∏ –Ω–µ–≤–¥–∞—á—ñ

## Performance

- **Lazy loading**: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è —Ç—ñ–ª—å–∫–∏ –ø—Ä–∏ –ø–æ—Ç—Ä–µ–±—ñ
- **Quality**: 85% –¥–ª—è –±–∞–ª–∞–Ω—Å—É –º—ñ–∂ —è–∫—ñ—Å—Ç—é —Ç–∞ —Ä–æ–∑–º—ñ—Ä–æ–º
- **Async**: –ù–µ –±–ª–æ–∫—É—î UI –ø—ñ–¥ —á–∞—Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó
- **Memory**: –ö–æ–Ω–≤–µ—Ä—Ç–æ–≤–∞–Ω—ñ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —è–∫ data URLs

## –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

–ñ–æ–¥–Ω–∏—Ö –∑–º—ñ–Ω –≤ API –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ! –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–¥–∞–π—Ç–µ –º–∞—Å–∏–≤ –∑–æ–±—Ä–∞–∂–µ–Ω—å:

```tsx
<BookingImageGallery 
  images={booking.images} 
  bookingNumber={booking.bookingNumber} 
/>
```

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ:
1. –î–µ—Ç–µ–∫—Ç—É—î HEIC —Ñ–∞–π–ª–∏
2. –ö–æ–Ω–≤–µ—Ä—Ç—É—î —ó—Ö
3. –í—ñ–¥–æ–±—Ä–∞–∂–∞—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏ (–Ω–µ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ)

### Backend –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è
**–ü–ª—é—Å–∏**: 
- –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–æ–Ω–≤–µ—Ä—Ç—É—é—Ç—å—Å—è –æ–¥–∏–Ω —Ä–∞–∑
- –ú–µ–Ω—à–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ –∫–ª—ñ—î–Ω—Ç

**–ú—ñ–Ω—É—Å–∏**:
- –ü–æ—Ç—Ä–µ–±—É—î –∑–º—ñ–Ω –Ω–∞ backend
- –î–æ–¥–∞—Ç–∫–æ–≤—ñ –≤–∏—Ç—Ä–∞—Ç–∏ –Ω–∞ S3 storage
- –°–∫–ª–∞–¥–Ω—ñ—à–µ –≤ –ø—ñ–¥—Ç—Ä–∏–º—Ü—ñ

### CloudFront Lambda@Edge
**–ü–ª—é—Å–∏**:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è on-the-fly
- –ö–µ—à—É–≤–∞–Ω–Ω—è –≤ CDN

**–ú—ñ–Ω—É—Å–∏**:
- –î–æ–¥–∞—Ç–∫–æ–≤—ñ –≤–∏—Ç—Ä–∞—Ç–∏ AWS
- –°–∫–ª–∞–¥–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- Overkill –¥–ª—è –Ω–∞—à–æ–≥–æ use case

## Dependency

```json
{
  "heic2any": "^0.0.4"
}
```

–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑: `npm install heic2any`

## Logs & Debugging

–í—Å—ñ –∫—Ä–æ–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó –ª–æ–≥—É—é—Ç—å—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å:
- üîÑ Detected HEIC file
- üì¶ Fetched blob
- ‚úÖ Converted to JPEG
- ‚úÖ Data URL created
- ‚ùå Failed to convert (—è–∫—â–æ –ø–æ–º–∏–ª–∫–∞)

---

**Made with ‚ù§Ô∏è by GitHub Copilot**
